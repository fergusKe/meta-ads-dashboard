# 專案優化調整計畫

> 目標：依序改善 `meta-ads-dashboard` 的維護性、設定一致性與測試覆蓋率。每個階段完成後再行確認。

## ✅ 總覽
- 階段 1：統一數據載入流程與設定來源
- 階段 2：LLM 服務參數化與錯誤處理強化
- 階段 3：重構主導航載入邏輯
- 階段 4：建立自動化測試骨架
- 階段 5：落實環境旗標與文件更新

## 🔄 階段細項

### 階段 1：統一數據載入流程與設定來源
- [x] 移除 `app.py` 內部的重複 `load_data()`，改為使用 `utils.data_loader.load_meta_ads_data`
- [x] 確保資料路徑會讀取 `.env` 中 `DATA_FILE_PATH`，並於側邊欄顯示當前來源
- [x] 整理日期/缺值處理邏輯，確認所有頁面取得相同欄位

### 階段 2：LLM 服務參數化與錯誤處理強化
- [x] 從環境變數載入 `OPENAI_MODEL`、`CACHE_TTL` 等設定並提供預設值
- [x] 明確區分 OpenAI SDK 未安裝、API key 缺失、配額不足等錯誤訊息
- [x] 於 README 補充如何設定新參數與常見錯誤排查

### 階段 3：重構主導航載入邏輯
- [x] 將頁面設定整理成結構化資料（例如列表或辭典）
- [x] 以迴圈渲染選單並統一導入頁面模組，降低重複碼
- [x] 加入例外處理與記錄，避免無法載入某頁面時整體崩潰

### 階段 4：建立自動化測試骨架
- [x] 引入 `pytest` 至 `pyproject.toml`
- [x] 拆出資料前處理函式的單元測試（含異常資料案例）
- [x] 規劃最小測試資料集或 fixture，避免依賴大型 Excel

### 階段 5：落實環境旗標與文件更新
- [x] 實作 `ENABLE_AI_*` 等旗標實際控制功能或移除無用設定
- [x] 使用 `.env.example` 與 README 說明旗標用途與建議值
- [x] 檢查整體文件（`docs/`、`README.md`）保持同步

---

> 下一步：完成「階段 1」後回報確認，再進行後續階段。
